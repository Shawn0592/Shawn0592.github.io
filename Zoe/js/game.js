game.newLoopFromConstructor('game_planet', function () {
	var pPos;

	var world = [];

	var level_finished = false;

	pjs.levels.forStringArray({w: 40, h: 40, source: [
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		'1111111111111111111111111111111111111111111111111111111111111',
		]}, function(S, X, Y, W, H){
		if (S === "1"){
			var randTile = pjs.math.random(1,30);
			if(randTile > 20) randTile = 10;
			if(randTile > 10) randTile = 9;
			world.push(game.newImageObject({
				x: X, y: Y,
				w: W, h: H,
				file: 'img/Tile/tile'+randTile+'.png',
				userData : {
					tile: randTile
				}
			}));
		}
	});

	this.update = function () {
		game.clear();

		if(key.isDown('A')) camera.move(point(-5, 0));
		if(key.isDown('D')) camera.move(point(5, 0));
		if(key.isDown('W')) camera.move(point(0, -5));
		if(key.isDown('S')) camera.move(point(0, 5));

		if(mouse.isWheel('UP')) camera.scaleC(point(1.1,1.1));
		if(mouse.isWheel('DOWN')) camera.scaleC(point(0.9,0.9));

		var selBlocks = [];

		OOP.forArr(world, function(w, idW){
			if (w.isInCameraStatic()){
				w.draw();

				if(mouse.isInStatic(w.getStaticBox())){
					selBlocks.push(w);

					if(w.tile != 9 && w.tile != 10){
						tileStats.innerHTML = `
							<div class="stats">
								<div class="tile" style="text-align:center;">
									<img width="50" height="50" src="img/Tile/tile`+w.tile+`.png">
								</div>
								<div class="info" style="margin-top:4px;text-align:center;">
									<p>X: `+w.x+`</p>
									<p>Y: `+w.y+`</p>
									<p>W: `+w.w+`</p>
									<p>H: `+w.h+`</p>
									<p>Tile: `+w.tile+`</p>
								</div>
								<div class="keys" style="margin-top: 4px;">
									<span class="label label-white">ЛКМ</span> - удалить
								</div>
							</div>
						`;
					} else {
						tileStats.innerHTML = ``;
					}

					if(mouse.isPress('LEFT')){
						if(w.tile != 10) {
							world.splice(idW, 1);
							var randTile = pjs.math.random(9,10);
							world.push(game.newImageObject({
								x: w.x, y: w.y,
								w: w.w, h: w.h,
								file: 'img/Tile/tile'+randTile+'.png',
								userData : {
									tile: randTile
								}
							}));
						}
					}
				}
			}
		});

		OOP.forArr(selBlocks, function(s){
			brush.drawRect({
				x: s.x, y: s.y,
				w: s.w, h: s.h,
				fillColor: 'rgba(0,0,0,0.1)'
			});
		});
	};

	this.entry = function () {
		// start
	};

	this.exit = function () {
		// game is stopped
	};

});

game.startLoop('game_planet');